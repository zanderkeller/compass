import{r as h,j as e}from"./index-CQ0jGMfQ.js";import{d as p,g as v,G as f}from"./GlassCard-Drm0HRq5.js";function D(){const[x,m]=h.useState([]),[j,g]=h.useState(!0);h.useEffect(()=>{y()},[]);const y=async()=>{try{await p.init();const s=v(),t=await p.getEmotionEntriesByTelegramId(s,7),r=new Date;r.setDate(r.getDate()-7);const a=t.filter(l=>new Date(l.date)>=r);console.log("Загружено записей эмоций:",a.length),m(a)}catch(s){console.error("Ошибка загрузки данных графика:",s),m([])}finally{g(!1)}},u=()=>{const s=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],t=new Date,r=[],a=t.getDay(),l=a===0?-6:1-a;for(let n=0;n<7;n++){const c=new Date(t);c.setDate(t.getDate()+l+n),r.push({date:c.toISOString().split("T")[0],label:s[n]})}return r};if(j)return e.jsx(f,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-cyan-400 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-white/60 text-xs",children:"Загрузка..."})]})});const i=u(),o=x.reduce((s,t)=>{const r=t.date;return s[r]||(s[r]={}),s[r][t.type]=t,s},{}),d=10;return x.length>0?e.jsxs(f,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-white text-base font-semibold",children:"График эмоций за неделю"}),e.jsx("i",{className:"ri-line-chart-line text-cyan-400 text-lg"})]}),e.jsxs("div",{className:"relative h-40 mb-6 ml-6",children:[e.jsxs("div",{className:"absolute -left-6 top-0 h-full flex flex-col justify-between text-white/40 text-xs",children:[e.jsx("span",{children:"10"}),e.jsx("span",{children:"8"}),e.jsx("span",{children:"6"}),e.jsx("span",{children:"4"}),e.jsx("span",{children:"2"}),e.jsx("span",{children:"0"})]}),Array.from({length:6},(s,t)=>e.jsx("div",{className:"absolute w-full border-t border-white/5",style:{top:`${t*20}%`}},t)),e.jsxs("svg",{className:"absolute inset-0 w-full h-full",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"morningGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#06b6d4",stopOpacity:"0.8"}),e.jsx("stop",{offset:"100%",stopColor:"#06b6d4",stopOpacity:"0.1"})]}),e.jsxs("linearGradient",{id:"eveningGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#8b5cf6",stopOpacity:"0.8"}),e.jsx("stop",{offset:"100%",stopColor:"#8b5cf6",stopOpacity:"0.1"})]}),e.jsxs("filter",{id:"glow",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"coloredBlur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),e.jsx("path",{fill:"url(#morningGradient)",d:`M 0,100 ${i.map((s,t)=>{const a=(o[s.date]||{}).morning,l=a?a.level:0,n=t/(i.length-1)*100,c=100-l/d*100;return`L ${n},${c}`}).join(" ")} L 100,100 Z`}),e.jsx("path",{fill:"url(#eveningGradient)",d:`M 0,100 ${i.map((s,t)=>{const a=(o[s.date]||{}).evening,l=a?a.level:0,n=t/(i.length-1)*100,c=100-l/d*100;return`L ${n},${c}`}).join(" ")} L 100,100 Z`,opacity:"0.6"}),e.jsx("path",{fill:"none",stroke:"#06b6d4",strokeWidth:"1.5",filter:"url(#glow)",d:`M ${i.map((s,t)=>{const a=(o[s.date]||{}).morning,l=a?a.level:0,n=t/(i.length-1)*100,c=100-l/d*100;return`${t===0?"":"L"} ${n},${c}`}).join(" ")}`}),e.jsx("path",{fill:"none",stroke:"#8b5cf6",strokeWidth:"1.5",strokeDasharray:"3,3",filter:"url(#glow)",d:`M ${i.map((s,t)=>{const a=(o[s.date]||{}).evening,l=a?a.level:0,n=t/(i.length-1)*100,c=100-l/d*100;return`${t===0?"":"L"} ${n},${c}`}).join(" ")}`}),i.map((s,t)=>{const a=(o[s.date]||{}).morning;if(!a)return null;const l=t/(i.length-1)*100,n=100-a.level/d*100;return e.jsxs("g",{children:[e.jsx("circle",{cx:l,cy:n,r:"3",fill:"#06b6d4",filter:"url(#glow)"}),e.jsx("circle",{cx:l,cy:n,r:"1.5",fill:"#ffffff"})]},`morning-${t}`)}),i.map((s,t)=>{const a=(o[s.date]||{}).evening;if(!a)return null;const l=t/(i.length-1)*100,n=100-a.level/d*100;return e.jsxs("g",{children:[e.jsx("circle",{cx:l,cy:n,r:"3",fill:"#8b5cf6",filter:"url(#glow)"}),e.jsx("circle",{cx:l,cy:n,r:"1.5",fill:"#ffffff"})]},`evening-${t}`)})]}),e.jsx("div",{className:"absolute -bottom-6 left-0 right-0 flex justify-between",children:i.map((s,t)=>e.jsx("div",{className:"text-white/60 text-xs text-center",children:s.label},`day-${t}`))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-center mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-cyan-400 text-base font-bold",children:Math.round(x.reduce((s,t)=>s+t.level,0)/x.length)}),e.jsx("div",{className:"text-white/60 text-xs",children:"Средний"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-purple-400 text-base font-bold",children:x.length}),e.jsx("div",{className:"text-white/60 text-xs",children:"Записей"})]})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-6 text-xs pt-3 border-t border-white/10",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-1 bg-gradient-to-r from-cyan-400 to-cyan-300 rounded-full"}),e.jsx("span",{className:"text-white/70",children:"Утро"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-1 bg-gradient-to-r from-purple-400 to-purple-300 rounded-full opacity-80",style:{backgroundImage:"repeating-linear-gradient(90deg, #8b5cf6 0px, #8b5cf6 3px, transparent 3px, transparent 6px)"}}),e.jsx("span",{className:"text-white/70",children:"Вечер"})]})]})]}):e.jsxs(f,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-white text-base font-semibold",children:"График эмоций"}),e.jsx("i",{className:"ri-line-chart-line text-cyan-400 text-lg"})]}),e.jsxs("div",{className:"text-center py-8",children:[e.jsx("i",{className:"ri-emotion-line text-white/30 text-4xl mb-3"}),e.jsx("p",{className:"text-white/60 text-sm mb-2",children:"Нет данных для графика"}),e.jsx("p",{className:"text-white/40 text-xs",children:"Начните делать ежедневные чек-ины"})]})]})}export{D as E};
//# sourceMappingURL=EmotionChart-BRQH462H.js.map
