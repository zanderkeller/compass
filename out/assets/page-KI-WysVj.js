import{r as c,j as e}from"./index-CQ0jGMfQ.js";import{g as W,G as g,d as o}from"./GlassCard-Drm0HRq5.js";import{B as A}from"./BottomNavigation-Bi7z2HkY.js";const u=[{id:"askeza",title:"Аскеза",description:"Духовные практики и самодисциплина",icon:"ri-meditation-line",color:"from-purple-400 to-indigo-500"},{id:"emotion-chart",title:"График эмоций",description:"Отслеживание настроения",icon:"ri-line-chart-line",color:"from-cyan-400 to-blue-5"},{id:"meditation",title:"Медитация",description:"Практики осознанности",icon:"ri-leaf-line",color:"from-green-400 to-emerald-500"},{id:"gratitude",title:"Благодарности",description:"Запишите 3 вещи за которые благодарны",icon:"ri-gift-line",color:"from-yellow-400 to-orange-500"},{id:"daily-forecast",title:"Прогноз на день",description:"Персональные рекомендации",icon:"ri-crystal-ball-line",color:"from-violet-400 to-purple-500",isPro:!0},{id:"jung-archetypes",title:"Архетипы Юнга",description:"Психологический анализ личности",icon:"ri-user-heart-line",color:"from-indigo-400 to-blue-600",isPro:!0}];function T(){var v;const[a,d]=c.useState([]),[r,n]=c.useState([]),[y,S]=c.useState(!0),[x,b]=c.useState(null),[w,j]=c.useState(null),m=W();c.useEffect(()=>{(async()=>{try{await o.init();const s=await o.getClientProfileByTelegramId(m);if(s){const i=Array.isArray(s.selected_widgets)?s.selected_widgets:typeof s.selected_widgets=="string"?JSON.parse(s.selected_widgets||"[]"):[],l=Array.isArray(s.widget_order)?s.widget_order:typeof s.widget_order=="string"?JSON.parse(s.widget_order||"[]"):i;d(i),n(l.length>0?l:i)}else{const i=["askeza","emotion-chart"];d(i),n(i)}}catch(s){console.error("Ошибка загрузки настроек:",s);const i=["askeza","emotion-chart"];d(i),n(i)}finally{S(!1)}})()},[m]);const h=async(t,s)=>{try{if(await o.init(),await o.getClientProfileByTelegramId(m)){const l={selected_widgets:t,widget_order:s,updated_at:new Date().toISOString()};await o.updateClientProfile(m,l)}else{const l={telegram_id:m,selected_widgets:t,widget_order:s,is_pro:!1,energy:850,completed_askezas:0,settings:"{}",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};await o.createClientProfile(l)}window.dispatchEvent(new CustomEvent("widgetsUpdated",{detail:{widgets:t,order:s}})),console.log("Настройки виджетов сохранены:",{widgets:t,order:s})}catch(i){console.error("Ошибка сохранения настроек:",i)}},p=async t=>{if(!a.includes(t)){const s=[...a,t],i=[...r,t];d(s),n(i),await h(s,i)}},O=async t=>{const s=a.filter(l=>l!==t),i=r.filter(l=>l!==t);d(s),n(i),j(null),await h(s,i)},P=async t=>{const s=r.indexOf(t);if(s>0){const i=[...r];[i[s],i[s-1]]=[i[s-1],i[s]],n(i),await h(a,i)}},_=async t=>{const s=r.indexOf(t);if(s<r.length-1){const i=[...r];[i[s],i[s+1]]=[i[s+1],i[s]],n(i),await h(a,i)}},k=(t,s)=>{b(s),t.dataTransfer.effectAllowed="move"},C=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},D=async(t,s)=>{if(t.preventDefault(),!x||x===s){b(null);return}const i=r.indexOf(x),l=r.indexOf(s),f=[...r];f.splice(i,1),f.splice(l,0,x),n(f),b(null),await h(a,f)},N=t=>u.find(s=>s.id===t);return y?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-black to-gray-800 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-cyan-400 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-white/70",children:"Загрузка настроек..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-black to-gray-800 relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 opacity-20",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 h-64 bg-cyan-400/10 rounded-full blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl animate-pulse delay-1000"})]}),e.jsxs("div",{className:"relative z-10 pb-28",children:[e.jsx("div",{className:"pt-6 pb-4 px-4",children:e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 flex items-center justify-center rounded-full bg-gradient-to-r from-cyan-400 to-blue-500",style:{boxShadow:"0 0 30px rgba(6, 182, 212, 0.5)"},children:e.jsx("span",{className:"text-white text-lg font-bold",style:{fontFamily:"Pacifico, serif"},children:"logo"})}),e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-purple-400 via-pink-400 to-lavender-400 bg-clip-text text-transparent animate-pulse mb-2",style:{fontFamily:"Orbitron, monospace"},children:"COMPASS"}),e.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent mb-2",children:"Настройки"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Управление виджетами и настройками"})]})}),e.jsxs("div",{className:"px-4 space-y-4 mb-6",children:[e.jsxs(g,{className:"p-4",children:[e.jsxs("h3",{className:"text-white text-lg font-semibold mb-4 flex items-center",children:[e.jsx("i",{className:"ri-user-line mr-2 text-cyan-400"}),"Профиль"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"w-full p-3 bg-white/5 hover:bg-white/10 rounded-lg transition-colors text-left",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("i",{className:"ri-edit-line text-cyan-400"}),e.jsx("span",{className:"text-white",children:"Редактировать профиль"})]}),e.jsx("i",{className:"ri-arrow-right-s-line text-white/60"})]})}),e.jsx("button",{className:"w-full p-3 bg-white/5 hover:bg-white/10 rounded-lg transition-colors text-left",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("i",{className:"ri-notification-line text-cyan-400"}),e.jsx("span",{className:"text-white",children:"Уведомления"})]}),e.jsx("i",{className:"ri-arrow-right-s-line text-white/60"})]})})]})]}),e.jsxs(g,{className:"p-4",children:[e.jsxs("h3",{className:"text-white text-lg font-semibold mb-4 flex items-center",children:[e.jsx("i",{className:"ri-database-line mr-2 text-cyan-400"}),"Данные"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"w-full p-3 bg-white/5 hover:bg-white/10 rounded-lg transition-colors text-left",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("i",{className:"ri-download-line text-cyan-400"}),e.jsx("span",{className:"text-white",children:"Экспорт данных"})]}),e.jsx("i",{className:"ri-arrow-right-s-line text-white/60"})]})}),e.jsx("button",{className:"w-full p-3 bg-white/5 hover:bg-white/10 rounded-lg transition-colors text-left",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("i",{className:"ri-delete-bin-line text-red-400"}),e.jsx("span",{className:"text-white",children:"Очистить все данные"})]}),e.jsx("i",{className:"ri-arrow-right-s-line text-white/60"})]})})]})]})]}),e.jsx("div",{className:"px-4 mb-6",children:e.jsxs(g,{className:"p-4",children:[e.jsxs("h3",{className:"text-white text-lg font-semibold mb-4 flex items-center",children:[e.jsx("i",{className:"ri-dashboard-line mr-2 text-cyan-400"}),"Виджеты на главной"]}),a.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 flex items-center justify-center rounded-full bg-white/10",children:e.jsx("i",{className:"ri-dashboard-line text-white/60 text-2xl"})}),e.jsx("h4",{className:"text-white font-medium mb-2",children:"Нет активных виджетов"}),e.jsx("p",{className:"text-white/60 text-sm mb-4",children:"Добавьте виджеты на главную страницу для быстрого доступа"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:u.slice(0,4).map(t=>e.jsxs("button",{onClick:()=>p(t.id),className:"p-3 bg-white/5 hover:bg-white/10 rounded-lg transition-colors border border-white/10",children:[e.jsx("div",{className:`w-8 h-8 mx-auto mb-2 flex items-center justify-center rounded-lg bg-gradient-to-r ${t.color}`,children:e.jsx("i",{className:`${t.icon} text-white text-sm`})}),e.jsx("p",{className:"text-white text-xs font-medium",children:t.title})]},t.id))})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 mb-4",children:r.map((t,s)=>{const i=N(t);return i?e.jsxs("div",{draggable:!0,onDragStart:l=>k(l,t),onDragOver:C,onDrop:l=>D(l,t),className:`relative p-4 rounded-xl border transition-all duration-300 cursor-move ${x===t?"border-cyan-400/50 bg-cyan-400/10 scale-105":"border-white/20 bg-white/5 hover:bg-white/10"}`,children:[i.isPro&&e.jsx("div",{className:"absolute top-2 right-2 px-2 py-1 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"PRO"})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("div",{className:"w-1 h-1 bg-white/40 rounded-full"}),e.jsx("div",{className:"w-1 h-1 bg-white/40 rounded-full"}),e.jsx("div",{className:"w-1 h-1 bg-white/40 rounded-full"})]}),e.jsx("div",{className:`w-12 h-12 flex items-center justify-center rounded-xl bg-gradient-to-r ${i.color} shadow-lg`,children:e.jsx("i",{className:`${i.icon} text-white text-xl`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-white font-medium text-base mb-1",children:i.title}),e.jsxs("p",{className:"text-white/60 text-sm",children:["Позиция: ",s+1]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>P(t),disabled:s===0,className:`w-8 h-8 rounded-full flex items-center justify-center transition-colors ${s===0?"bg-white/10 text-white/30 cursor-not-allowed":"bg-white/20 text-white hover:bg-white/30"}`,children:e.jsx("i",{className:"ri-arrow-up-s-line text-sm"})}),e.jsx("button",{onClick:()=>_(t),disabled:s===r.length-1,className:`w-8 h-8 rounded-full flex items-center justify-center transition-colors ${s===r.length-1?"bg-white/10 text-white/30 cursor-not-allowed":"bg-white/20 text-white hover:bg-white/30"}`,children:e.jsx("i",{className:"ri-arrow-down-s-line text-sm"})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),j(t)},className:"w-10 h-10 rounded-full bg-red-500/20 text-red-400 hover:bg-red-500/30 transition-colors flex items-center justify-center",children:e.jsx("i",{className:"ri-close-line text-xl"})})]})]})]},t):null})}),u.filter(t=>!a.includes(t.id)).length>0&&e.jsxs("div",{className:"border-t border-white/10 pt-4",children:[e.jsx("h4",{className:"text-white/80 text-sm font-medium mb-3",children:"Доступные виджеты:"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:u.filter(t=>!a.includes(t.id)).map(t=>e.jsxs("button",{onClick:()=>p(t.id),className:"relative p-3 bg-white/5 hover:bg-white/10 rounded-lg transition-colors border border-white/10",children:[t.isPro&&e.jsx("div",{className:"absolute top-1 right-1 px-1 py-0.5 bg-gradient-to-r from-yellow-400 to-orange-500 rounded text-white text-xs font-bold",children:"PRO"}),e.jsx("div",{className:`w-8 h-8 mx-auto mb-2 flex items-center justify-center rounded-lg bg-gradient-to-r ${t.color}`,children:e.jsx("i",{className:`${t.icon} text-white text-sm`})}),e.jsx("p",{className:"text-white text-xs font-medium",children:t.title})]},t.id))})]})]})]})})]}),w&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(g,{className:"w-full max-w-sm p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 flex items-center justify-center rounded-full bg-red-500/20",children:e.jsx("i",{className:"ri-delete-bin-line text-red-400 text-2xl"})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Удалить виджет?"}),e.jsx("p",{className:"text-white/70 text-sm mb-1",children:(v=N(w))==null?void 0:v.title}),e.jsx("p",{className:"text-white/50 text-xs",children:"Виджет будет удален с главной страницы"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>O(w),className:"w-full py-3 px-4 rounded-xl bg-red-500 hover:bg-red-600 text-white font-medium transition-colors",children:[e.jsx("i",{className:"ri-delete-bin-line mr-2"}),"Удалить"]}),e.jsxs("button",{onClick:()=>j(null),className:"w-full py-3 px-4 rounded-xl bg-white/10 hover:bg-white/20 text-white font-medium transition-colors",children:[e.jsx("i",{className:"ri-close-line mr-2"}),"Отмена"]})]})]})}),e.jsx(A,{})]})}export{T as default};
//# sourceMappingURL=page-KI-WysVj.js.map
